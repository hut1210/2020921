webpackJsonp([29],{"1ZXU":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o("BO1k"),a=o.n(r),s={data:function(){return{proDescData:[],nextSubmitData:[],ispro:this.$route.query.ispro,flag:!0,flages:!1,showFlage:!1,id:"",form:{plan_list:[]},giveForm:{project_id:"",type:1,current_plan_id:"",current_plan_name:"",current_plan_explain:"",current_next_content:"",current_status:"",is_end:"",report:"",report_content:"",plan_id:[],name:[],start_time:[],end_time:[],executor:[],sort_order:[]},activities:[],formAll:{},checkedList:[],options:[],lastId:"",sortId:""}},created:function(){this.id=this.$route.query.id,this.getTestrand(),this.getcompanytype(),this.getCont()},mounted:function(){this.getproDescData()},methods:{changeProDesc:function(e){var t=this;this.form.next_content=[],this.$api.get("/planNext",{pid:e},function(e){t.nextSubmitData=e.data},function(e){self.$message.error(e.msg)})},open:function(e){var t=this,o=this;if(5==o.$utils.getloc("group_id"))return!1;this.$store.commit("xianshi");var r=localStorage.getItem("token");this.$api.getTall("/getFrindChat/?token="+r+"&to_member_id="+e.pro_member,{},function(r){r.data;for(var a="",s=0;s<r.data.length;s++)if(r.data[s].another_id==e.pro_member){var l=s.toString();o.$store.commit("setActiveIndex",l),a=r.data[s].chat_id}var i=r.data;t.$store.commit("setList",i),o.$api.getTall("/getChatMessage",{chat_id:a,page:1},function(e){o.$store.commit("setChatLeftData",e.data.list)})})},goback:function(){this.$router.go(-1)},getTestrand:function(){var e=this;e.$api.get("/testrand",{type:""},function(t){var o={};for(var r in t.data)(o={}).id=r,o.name=t.data[r],e.checkedList.push(o)},function(t){e.$message.error(t.msg)})},getcompanytype:function(){var e=this;e.$api.post("companytype",{},function(t){for(var o in t.data)e.options.push(t.data[o])})},getCont:function(){var e=this,t=this;t.$api.get("/project/"+t.id,{},function(o){e.getproDescData(o.data.now_plan_id),t.form=o.data,t.form.testid=t.form.testid.split(""),t.form.is_overdue=t.form.is_overdue.toString(),t.lastId=t.form.plan_list[t.form.plan_list.length-1].id,"测试完成"==o.data.now_plan_name&&(t.showFlage=!0),t.form.current_plan_id==t.lastId&&(t.showFlage=!0);var r=!0,s=!1,l=void 0;try{for(var i,n=a()(t.form.plan_list);!(r=(i=n.next()).done);r=!0){var c=i.value;1==c.status&&(c.color="#666"),2==c.status&&(c.color="#ccc"),3==c.status&&(c.color="#66CE90"),1==c.is_overdue&&(c.color="red"),1==c.executor&&(c.size="large"),c.executor=c.executor.toString(),c.data=["",""],c.data=[c.start_time,c.end_time]}}catch(e){s=!0,l=e}finally{try{!r&&n.return&&n.return()}finally{if(s)throw l}}})},selectChange:function(e){this.getproDescData(e),this.form.tempo_explain="",this.form.next_content=[],this.form.now_plan_id==this.lastId?this.showFlage=!0:this.showFlage=!1},addPath:function(){self=this;for(var e=[],t=0;t<self.form.plan_list.length-2;t++)e[t]=self.form.plan_list[t];if((self.form.plan_list.length-11)/3+2){var o=(self.form.plan_list.length-11)/3+2,r=["零","一","二","三","四","五"];if(o>4)return self.$message.error("超乎我的预期了"),!1;e.push({date:[],name:r[o]+"轮整改",executor:"2",sort_order:e.length+1}),e.push({date:[],name:r[o+1]+"轮环境搭建",executor:"2",sort_order:e.length+1}),e.push({date:[],name:r[o+1]+"轮测试",executor:"1",sort_order:e.length+1}),e.push({date:[],name:"测试完成",executor:"1",sort_order:e.length+1}),e.push({date:[],name:"测试报告",executor:"1",sort_order:e.length+1}),self.form.plan_list=e}},preservation:function(){var e=this,t=this,o=!0,r=!1,s=void 0;try{for(var l,i=a()(t.form.plan_list);!(o=(l=i.next()).done);o=!0){var n=l.value;t.giveForm.plan_id.push(n.id),t.giveForm.name.push(n.name),t.giveForm.start_time.push(n.data[0]),t.giveForm.end_time.push(n.data[1]),t.giveForm.executor.push(n.executor),t.giveForm.sort_order.push(n.sort_order)}}catch(e){r=!0,s=e}finally{try{!o&&i.return&&i.return()}finally{if(r)throw s}}1==t.flages?t.giveForm.type=2:t.giveForm.type=1,t.giveForm.project_id=t.form.project_id,t.giveForm.current_plan_id=t.form.now_plan_id,t.giveForm.current_plan_name=t.form.current_plan_name,t.giveForm.current_plan_explain=t.form.tempo_explain,t.giveForm.current_next_content=t.form.next_content,t.giveForm.current_status=t.form.is_overdue,t.giveForm.is_end=t.form.is_end,t.giveForm.report=t.form.report,t.giveForm.report_content=t.form.report_content,t.giveForm.num_day=t.form.num_day,t.giveForm.code_bug=t.form.code_bug,t.giveForm.function_bug=t.form.function_bug,t.giveForm.safe_bug=t.form.safe_bug,t.giveForm.test_rounds=t.form.test_rounds,t.giveForm.unexecuted=t.form.unexecuted,t.$api.put("/project/"+t.id,t.giveForm,function(o){t.$message({message:"修改成功",type:"success"}),setTimeout(function(){e.$router.push({path:"/test-items"})},1e3)})},getproDescData:function(e){var t=this;this.$api.get("/planNow",{id:e},function(e){t.proDescData=e.data},function(e){self.$message.error(e.msg)})}}},l={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"schedule-out-box"},[o("div",{staticClass:"information"},[o("div",{staticClass:"button"},[e._v("项目信息")]),e._v(" "),o("div",{staticClass:"information-center"},[o("center",[o("el-form",{ref:"form",attrs:{model:e.form,"label-position":"right","label-width":"180px"}},[o("el-form-item",{attrs:{label:"项目名称:",prop:""}},[o("div",{staticClass:"form-div"},[e._v(e._s(e.form.pro_name))])]),e._v(" "),o("el-form-item",{attrs:{label:"产品名称:"}},[o("div",{staticClass:"form-div"},[e._v(e._s(e.form.product_name))])]),e._v(" "),o("el-form-item",{attrs:{label:"产品版本号:"}},[o("div",{staticClass:"form-div"},[e._v(e._s(e.form.version))])]),e._v(" "),o("el-form-item",{attrs:{label:"所属公司:"}},[o("div",{staticClass:"form-div"},[e._v(e._s(e.form.pro_company_name))])]),e._v(" "),o("el-form-item",{attrs:{label:"测试范围:"}},[o("div",{staticClass:"form-div",staticStyle:{"white-space":"nowrap"}},[o("el-checkbox-group",{model:{value:e.form.testid,callback:function(t){e.$set(e.form,"testid",t)},expression:"form.testid"}},e._l(e.checkedList,function(t){return o("el-checkbox",{key:t.id,attrs:{label:t.id,disabled:""}},[e._v(e._s(t.name))])}),1)],1)]),e._v(" "),o("el-form-item",{attrs:{label:"项目经理:"}},[o("div",{staticClass:"form-div"},[e._v(e._s(e.form.pro_realname))])]),e._v(" "),o("el-form-item",{attrs:{label:"联系方式:"}},[o("div",{staticClass:"form-div"},[e._v(e._s(e.form.pro_mobile))])]),e._v(" "),o("el-form-item",{attrs:{label:"用户账号:"}},[o("div",{staticClass:"form-div div-click",on:{click:function(t){return e.open(e.form)}}},[o("span",{staticClass:"form-label-span"},[e._v(e._s(e.form.pro_username))]),e._v(" "),2==e.$utils.getloc("group_id")?o("span",[e._v("(点击在线沟通)")]):e._e()])])],1)],1)],1)]),e._v(" "),"已完成"!=e.ispro?o("div",{ref:"form",staticClass:"progress"},[o("div",{staticClass:"button"},[e._v("检测进度")]),e._v(" "),o("div",{staticClass:"progress-center"},[o("center",[o("el-form",{ref:"form",attrs:{model:e.form,"label-position":"right","label-width":"180px"}},[o("el-form-item",{attrs:{label:"当前进度:"}},[o("el-select",{staticClass:"flex",attrs:{placeholder:""},on:{change:e.selectChange},model:{value:e.form.now_plan_id,callback:function(t){e.$set(e.form,"now_plan_id",t)},expression:"form.now_plan_id"}},e._l(e.form.plan_list,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id,disabled:2==e.status}})}),1),e._v(" "),o("el-select",{staticClass:"flex",attrs:{placeholder:""},model:{value:e.form.is_overdue,callback:function(t){e.$set(e.form,"is_overdue",t)},expression:"form.is_overdue"}},[o("el-option",{attrs:{label:"正常",value:"0"}}),e._v(" "),o("el-option",{attrs:{label:"异常",value:"1"}})],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"当前进度说明:"}},[o("el-select",{staticStyle:{width:"24.3rem"},attrs:{placeholder:"请选择"},on:{change:e.changeProDesc},model:{value:e.form.tempo_explain,callback:function(t){e.$set(e.form,"tempo_explain",t)},expression:"form.tempo_explain"}},e._l(e.proDescData,function(e){return o("el-option",{key:e.id,attrs:{label:e.plan_name,value:e.id}})}),1)],1),e._v(" "),o("el-form-item",{attrs:{label:"下一阶段送检准备工作:"}},[o("el-select",{staticStyle:{width:"24.3rem"},attrs:{placeholder:"请选择"},model:{value:e.form.next_content,callback:function(t){e.$set(e.form,"next_content",t)},expression:"form.next_content"}},e._l(e.nextSubmitData,function(e){return o("el-option",{key:e.id,attrs:{label:e.plan_name,value:e.id}})}),1)],1),e._v(" "),e.showFlage?o("el-form-item",{attrs:{label:"项目进度："}},[o("el-radio-group",{staticStyle:{"text-align":"left"},attrs:{disabled:5==e.$utils.getloc("group_id")},model:{value:e.form.is_end,callback:function(t){e.$set(e.form,"is_end",t)},expression:"form.is_end"}},[o("el-radio",{attrs:{label:0}},[e._v("检测中")]),e._v(" "),o("el-radio",{attrs:{label:1}},[e._v("检测完成")])],1)],1):e._e(),e._v(" "),e.showFlage?o("el-form-item",{attrs:{label:"报告标题："}},[o("el-input",{attrs:{type:"text",disabled:5==e.$utils.getloc("group_id")},model:{value:e.form.report,callback:function(t){e.$set(e.form,"report",t)},expression:"form.report"}})],1):e._e(),e._v(" "),e.showFlage?o("el-form-item",{attrs:{label:"报告内容："}},[o("el-input",{attrs:{type:"textarea",rows:4,disabled:5==e.$utils.getloc("group_id")},model:{value:e.form.report_content,callback:function(t){e.$set(e.form,"report_content",t)},expression:"form.report_content"}})],1):e._e(),e._v(" "),e.showFlage?o("el-form-item",{attrs:{label:"测试耗时："}},[o("el-input",{attrs:{type:"",disabled:5==e.$utils.getloc("group_id")},model:{value:e.form.num_day,callback:function(t){e.$set(e.form,"num_day",t)},expression:"form.num_day"}}),e._v(" "),o("span",{staticClass:"item-span"},[e._v("天")])],1):e._e(),e._v(" "),e.showFlage?o("el-form-item",{attrs:{label:"代码缺陷率："}},[o("el-input",{attrs:{type:"",disabled:5==e.$utils.getloc("group_id")},model:{value:e.form.code_bug,callback:function(t){e.$set(e.form,"code_bug",t)},expression:"form.code_bug"}}),e._v(" "),o("span",{staticClass:"item-span"},[e._v("‰")])],1):e._e(),e._v(" "),e.showFlage?o("el-form-item",{attrs:{label:"功能缺陷率："}},[o("el-input",{attrs:{type:"",disabled:5==e.$utils.getloc("group_id")},model:{value:e.form.function_bug,callback:function(t){e.$set(e.form,"function_bug",t)},expression:"form.function_bug"}}),e._v(" "),o("span",{staticClass:"item-span"},[e._v("‰")])],1):e._e(),e._v(" "),e.showFlage?o("el-form-item",{attrs:{label:"安全缺陷率："}},[o("el-input",{attrs:{type:"",disabled:5==e.$utils.getloc("group_id")},model:{value:e.form.safe_bug,callback:function(t){e.$set(e.form,"safe_bug",t)},expression:"form.safe_bug"}}),e._v(" "),o("span",{staticClass:"item-span"},[e._v("‰")])],1):e._e(),e._v(" "),e.showFlage?o("el-form-item",{attrs:{label:"测试轮次："}},[o("el-input",{attrs:{type:"",disabled:5==e.$utils.getloc("group_id")},model:{value:e.form.test_rounds,callback:function(t){e.$set(e.form,"test_rounds",t)},expression:"form.test_rounds"}}),e._v(" "),o("span",{staticClass:"item-span"},[e._v("次")])],1):e._e(),e._v(" "),e.showFlage?o("el-form-item",{attrs:{label:"安全方案未执行条数："}},[o("el-input",{attrs:{type:"",disabled:5==e.$utils.getloc("group_id")},model:{value:e.form.unexecuted,callback:function(t){e.$set(e.form,"unexecuted",t)},expression:"form.unexecuted"}}),e._v(" "),o("span",{staticClass:"item-span"},[e._v("条")])],1):e._e()],1)],1)],1)]):e._e(),e._v(" "),o("div",{staticClass:"exhibition"},[o("div",{staticClass:"button"},[e._v("检测流程进度排程展示")]),e._v(" "),e.flages?e._e():o("center",[o("el-timeline",e._l(e.form.plan_list,function(t,r){return o("el-timeline-item",{key:r,attrs:{color:t.color,placement:"bottom",size:t.size}},[o("div",{staticClass:"time-line",style:{color:t.color?t.color:"red"}},[e._v(e._s(t.start_time))]),e._v(" "),o("div",{style:{color:t.color?t.color:"red"}},[e._v(e._s(t.name)+" ("+e._s(1==t.executor?"检测方":"送检方")+")")]),e._v(" "),o("div",{style:{color:t.color?t.color:"red"}},[e._v(e._s(t.tempo_explain))]),e._v(" "),o("div",{style:{color:t.color?t.color:"red"}},[e._v(e._s(t.next_content))])])}),1)],1),e._v(" "),e.flages?o("div",{staticClass:"technological-table"},[o("el-table",{staticStyle:{width:"100%"},attrs:{data:e.form.plan_list}},[o("el-table-column",{attrs:{prop:"",label:"",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-input",{attrs:{placeholder:"请输入流程名称",disabled:""},model:{value:t.row.name,callback:function(o){e.$set(t.row,"name",o)},expression:"scope.row.name"}})]}}],null,!1,2636476087)}),e._v(" "),o("el-table-column",{attrs:{label:"",width:"360"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:t.row.data,callback:function(o){e.$set(t.row,"data",o)},expression:"scope.row.data"}})]}}],null,!1,114857240)}),e._v(" "),o("el-table-column",{attrs:{prop:"",label:"",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-select",{attrs:{placeholder:"执行人"},model:{value:t.row.executor,callback:function(o){e.$set(t.row,"executor",o)},expression:"scope.row.executor"}},[o("el-option",{attrs:{label:"检测方",value:"1"}}),e._v(" "),o("el-option",{attrs:{label:"送检方",value:"2"}})],1)]}}],null,!1,1412692478)}),e._v(" "),o("el-table-column",{attrs:{prop:"",label:"",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-input",{attrs:{placeholder:"排序",disabled:""},on:{blur:function(o){return e.changeSort(t.row.sort_order,t.$index)}},model:{value:t.row.sort_order,callback:function(o){e.$set(t.row,"sort_order",o)},expression:"scope.row.sort_order"}})]}}],null,!1,4054863761)})],1),e._v(" "),o("el-button",{staticStyle:{"margin-top":"20px"},on:{click:e.addPath}},[e._v("增加流程")])],1):e._e(),e._v(" "),e.flages&&2!=e.$utils.getloc("group_id")?e._e():o("div",{directives:[{name:"show",rawName:"v-show",value:0==e.form.is_end,expression:"form.is_end == 0"}],ref:"form",staticClass:"adjustment-btn"},[o("el-button",{on:{click:function(t){e.flages=!0}}},[e._v("调整排程")])],1),e._v(" "),2==e.$utils.getloc("group_id")?o("div",{ref:"form",staticClass:"sub-btn"},[o("el-button",{staticClass:"sub-btn-child",attrs:{type:"success"},on:{click:e.preservation}},[e._v("保存")]),e._v(" "),o("el-button",{staticClass:"sub-btn-child",on:{click:e.goback}},[e._v("返回"+e._s(e.sortId))])],1):e._e()],1)])},staticRenderFns:[]};var i=o("VU/8")(s,l,!1,function(e){o("WYEJ")},"data-v-7820d494",null);t.default=i.exports},WYEJ:function(e,t){}});
//# sourceMappingURL=29.67d8c33ecb3dcf717a4d.js.map